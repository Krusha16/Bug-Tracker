@model IPagedList<BugTracker.Models.Ticket>

@{
    ViewBag.Title = "AllTickets";
}

<h2>AllTickets</h2>

@using PagedList;
@using PagedList.Mvc;

<div class="navigate">
    <div class="nav1">
        <div class="create">
            @if (ViewBag.Roles.Contains("Submitter"))
            {
                <p>
                    @Html.ActionLink("Create New Ticket", "Create", "Tickets")
                </p>
            }
            @if (ViewBag.Roles.Contains("Project Manager") || ViewBag.Roles.Contains("Admin"))
            {
                <p>
                    @Html.ActionLink("Create New Project", "Create", "Projects")
                </p>
            }
            <p>
                @Html.ActionLink("View All Your Projects", "AllProjects", "Projects")
            </p>
        </div>
    </div>
    <div class="navigate">
        <p><b>Sort Options:</b></p>
        <div>
            <button class="question" type="button"><p class="link"> @Html.ActionLink("TYPES", "SortTickets", "Tickets", new { sortBy = "type" }, new { style = "color: white;text-decoration:none" }) </p></button>

            <button class="question" type="button"><p class="link"> @Html.ActionLink("STATUS", "SortTickets", "Tickets", new { sortBy = "status" }, new { style = "color: white;text-decoration:none" }) </p></button>

            <button class="question" type="button"><p class="link"> @Html.ActionLink("PRIORITY", "SortTickets", "Tickets", new { sortBy = "priority" }, new { style = "color: white;text-decoration:none" }) </p></button>

            <button class="question" type="button"><p class="link"> @Html.ActionLink("CREATION", "SortTickets", "Tickets", new { sortBy = "creation" }, new { style = "color: white;text-decoration:none" }) </p></button>

            <button class="question" type="button"><p class="link"> @Html.ActionLink("RECENTLY UPDATED", "SortTickets", "Tickets", new { sortBy = "update" }, new { style = "color: white;text-decoration:none" }) </p></button>

            <button class="question" type="button"><p class="link"> @Html.ActionLink("TITLE", "SortTickets", "Tickets", new { sortBy = "title" }, new { style = "color: white;text-decoration:none" }) </p></button>

            <button class="question" type="button"><p class="link"> @Html.ActionLink("OWNER", "SortTickets", "Tickets", new { sortBy = "owner" }, new { style = "color: white;text-decoration:none" }) </p></button>

            <button class="question" type="button"><p class="link"> @Html.ActionLink("DEVELOPER", "SortTickets", "Tickets", new { sortBy = "developer" }, new { style = "color: white;text-decoration:none" }) </p></button>

            <button class="question" type="button"><p class="link"> @Html.ActionLink("PROJECT", "SortTickets", "Tickets", new { sortBy = "project" }, new { style = "color: white;text-decoration:none" }) </p></button>
        </div>
    </div>
</div>
<br/>
<div>
    @using (Html.BeginForm("SearchTickets", "Tickets", FormMethod.Get))
    {
        <p><b>Search Options:</b></p>
        @Html.RadioButton("option", "Project")<text>Project </text>
        @Html.RadioButton("option", "Priority")<text>Priority </text>
        @Html.RadioButton("option", "Status")<text>Status </text>
        @Html.RadioButton("option", "Type")<text>Type </text>
        @Html.RadioButton("option", "Title")<text>Title </text>
        @Html.RadioButton("option", "Description")<text>Description </text>

        @Html.TextBox("searchBy")
        <input type="submit" name="submit" value="SearchTickets" />

    }
</div>

<table class="table">
    <tr>
        <th>
            @Html.DisplayName("Developer Email")
        </th>
        <th>
            @Html.DisplayName("Submitter Email")
        </th>
        <th>
            @Html.DisplayName("Project Name")
        </th>
        <th>
            @Html.DisplayName("Ticket Priority")
        </th>
        <th>
            @Html.DisplayName("Ticket Status")
        </th>
        <th>
            @Html.DisplayName("Ticket Type")
        </th>
        <th>
            @Html.DisplayName("Ticket Title")
        </th>
        <th>
            @Html.DisplayName("Ticket Description")
        </th>
        <th>
            @Html.DisplayName("Date Created")
        </th>
        <th>
            @Html.DisplayName("Date Updated")
        </th>
        <th>
            @Html.DisplayName("Attachments")
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.AssignedToUser.Email)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.OwnerUser.Email)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Project.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.TicketPriority.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.TicketStatus.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.TicketType.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Title)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Description)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Created)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Updated)
            </td>
            <td>
                @foreach (var attachment in item.TicketAttachments)
                {
                    <p>Description: @attachment.Description</p>
                    <p>Added By: @attachment.User.Email</p>
                    @Html.ActionLink("Edit Attachment", "EditAttachment", new { id = attachment.Id } , null) 
                    @Html.ActionLink("Delete Attachment", "DeleteAttachment", new { id = attachment.Id })
                }

            </td>
            <td>
                @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                @Html.ActionLink("Add Attachment", "AddAttachmentToTicket", new { id = item.Id }) |
                @Html.ActionLink("Delete", "Delete", new { id = item.Id }) |
                @if (ViewBag.Roles.Contains("Project Manager") || ViewBag.Roles.Contains("Admin"))
                {
                    @Html.ActionLink("Assign Developer", "AssignDeveloperToTicket", new { id = item.Id })
                    <br />
                    @Html.ActionLink("Update Status", "UpdateStatus", new { id = item.Id })
                }
            </td>
        </tr>
    }
</table>

@Html.PagedListPager(Model, i => Url.Action("AllTickets", "Tickets", new { i }))
